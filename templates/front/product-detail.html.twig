{% extends 'base_front.html.twig' %}

{% block title %}{{ product.name }}{% endblock %}

{% block body %}
    <!-- Banner Title Section -->
    <div class="page-heading-banner bg-img1" style="background-image: url('{{ asset('front/images/bg-02.jpg') }}');">
        <div class="container">
            <div class="page-title-text text-center">
                <h2>{{ product.name }}</h2>
            </div>
        </div>
    </div>
    
    <!-- Content page -->
    <section class="sec-product-detail bg0 p-b-60">
        <div class="container">
            <div class="row">
                <!-- Product Image -->
                <div class="col-md-6 col-lg-7 p-b-30">
                    <div class="p-lr-0-lg product-image-container">
                        <div class="wrap-slick3 flex-sb flex-w">
                            <div class="wrap-slick3-dots"></div>
                            <div class="wrap-slick3-arrows flex-sb-m flex-w"></div>
                            <div class="slick3 gallery-lb product-main-image">
                                {% if product.primaryImage %}
                                <!-- Show primary image first -->
                                <div class="item-slick3" data-thumb="{{ asset('uploads/products/' ~ product.primaryImage.imagePath) }}">
                                    <div class="wrap-pic-w pos-relative">
                                        <img src="{{ asset('uploads/products/' ~ product.primaryImage.imagePath) }}" alt="{{ product.name }} - Primary Image">
                                    </div>
                                </div>
                                {% endif %}
                                
                                {% if product.images|length > 0 %}
                                    {% for image in product.images %}
                                        {% if not (product.primaryImage and image.id == product.primaryImage.id) %}
                                        <div class="item-slick3" data-thumb="{{ asset('uploads/products/' ~ image.imagePath) }}">
                                            <div class="wrap-pic-w pos-relative">
                                                <img src="{{ asset('uploads/products/' ~ image.imagePath) }}" alt="{{ product.name }} - Image {{ loop.index }}">
                                            </div>
                                        </div>
                                        {% endif %}
                                    {% endfor %}
                                {% endif %}
                                
                                {% if not product.primaryImage and product.images|length == 0 %}
                                <div class="item-slick3" data-thumb="{{ asset('back/img/placeholder.jpg') }}">
                                    <div class="wrap-pic-w pos-relative">
                                        <img src="{{ asset('back/img/placeholder.jpg') }}" alt="{{ product.name }} - No Image">
                                    </div>
                                </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Product Information -->                
                <div class="col-md-6 col-lg-5 p-b-30">
                    <div class="product-info p-4">
                        <!-- Product Name and Price -->                    
                        <h1 class="product-title mb-3">{{ product.name }}</h1>
                        <div class="price-container mb-4">
                            <span class="product-price">{{ product.price|number_format(2, '.', ',') }} TND</span>
                        </div>
                        
                        <!-- Rating Stars -->                        
                        <div class="ratings mb-4">
                            <span class="stars">
                                <i class="fa fa-star"></i>
                                <i class="fa fa-star"></i>
                                <i class="fa fa-star"></i>
                                <i class="fa fa-star"></i>
                                <i class="fa fa-star-half-o"></i>
                            </span>
                            <span class="rating-count">(4.5/5)</span>
                        </div>
                        
                        <!-- Product Description -->                        
                        <div class="product-description mb-4">
                            <p>{{ product.description }}</p>
                        </div>
                        
                        <hr class="my-4">
                        
                        <!-- Product Details -->                        
                        <div class="product-details mb-4">
                            <!-- Category -->                            
                            <div class="detail-row d-flex align-items-center mb-3">
                                <div class="detail-label">Catégorie:</div>
                                <div class="detail-value">{{ product.category }}</div>
                            </div>
                            
                            <!-- Availability -->                            
                            <div class="detail-row d-flex align-items-center mb-3">
                                <div class="detail-label">Disponibilité:</div>
                                <div class="detail-value"><span class="text-success">En stock</span></div>
                            </div>
                        </div>
                        
                        <!-- Color Selection -->                        
                        <div class="color-selection mb-4">
                            <h5 class="option-title">Couleur</h5>
                            <div class="color-options">
                                {% if product.colors|length > 0 %}
                                    {% for color in product.colors %}
                                        <input type="radio" id="color-{{ color.id }}" name="color" value="{{ color.id }}" class="color-radio" {% if loop.first %}checked{% endif %}>
                                        <label for="color-{{ color.id }}" class="color-btn" style="background-color: {{ color.code }}" title="{{ color.name }}"></label>
                                    {% endfor %}
                                {% else %}
                                    <p class="text-muted">Pas d'options de couleur disponibles</p>
                                {% endif %}
                            </div>
                        </div>
                        
                        <!-- Size Selection -->                        
                        <div class="size-selection mb-4">
                            <h5 class="option-title">Taille</h5>
                            <div class="size-options">
                                <input type="radio" id="size-s" name="size" value="S" class="size-radio" checked>
                                <label for="size-s" class="size-btn">S</label>

                                <input type="radio" id="size-m" name="size" value="M" class="size-radio">
                                <label for="size-m" class="size-btn">M</label>

                                <input type="radio" id="size-l" name="size" value="L" class="size-radio">
                                <label for="size-l" class="size-btn">L</label>

                                <input type="radio" id="size-xl" name="size" value="XL" class="size-radio">
                                <label for="size-xl" class="size-btn">XL</label>
                            </div>
                        </div>
                        
                        <!-- Quantity Selection -->                        
                        <div class="quantity-container mb-4">
                            <h5 class="option-title">Quantité</h5>
                            <div class="quantity-selector d-flex align-items-center">
                                <div class="btn-num-product-down qty-btn">
                                    <i class="fa fa-minus"></i>
                                </div>

                                <input class="qty-input" type="number" name="num-product" value="1" min="1">

                                <div class="btn-num-product-up qty-btn">
                                    <i class="fa fa-plus"></i>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Add to Cart Button -->                        
                        <div class="cart-actions">
                            <form action="{{ path('add_to_cart', {'id': product.id}) }}" method="post" class="w-100">
                                <input type="hidden" name="size" id="selected-size" value="S">
                                <input type="hidden" name="quantity" id="selected-quantity" value="1">
                                {% if product.colors|length > 0 %}
                                <input type="hidden" name="color_id" id="selected-color" value="{{ product.colors|first.id }}">
                                {% endif %}
                                
                                <div class="d-flex mb-3">
                                    <button type="submit" class="add-to-cart-btn">
                                        <i class="fa fa-shopping-cart mr-2"></i> Ajouter au panier
                                    </button>
                                    <button type="button" class="wishlist-btn ml-3">
                                        <i class="fa fa-heart"></i>
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
{% endblock %}

{% block stylesheets %}
{{ parent() }}
<style>
    /* Modern Product Detail Styling */
    .product-image-container {
        background-color: #f9f9f9;
        border-radius: 8px;
        overflow: hidden;
        box-shadow: 0 2px 10px rgba(0,0,0,0.05);
    }
    
    .product-main-image img {
        width: 100%;
        height: auto;
        object-fit: contain;
        max-height: 500px;
        transition: transform 0.3s ease;
    }
    
    .product-main-image:hover img {
        transform: scale(1.02);
    }
    
    .product-info {
        background-color: #fff;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        height: 100%;
    }
    
    .product-title {
        font-size: 1.8rem;
        font-weight: 600;
        color: #333;
        margin-bottom: 0.5rem;
    }
    
    .product-price {
        font-size: 1.6rem;
        font-weight: 600;
        color: #e63946;
    }
    
    /* Rating stars styling */
    .ratings .stars {
        color: #ffc107;
        margin-right: 10px;
    }
    
    .rating-count {
        color: #666;
        font-size: 0.9rem;
    }
    
    /* Product details styling */
    .product-description {
        color: #555;
        line-height: 1.6;
    }
    
    .detail-row {
        margin-bottom: 8px;
    }
    
    .detail-label {
        font-weight: 500;
        color: #333;
        width: 120px;
    }
    
    .detail-value {
        color: #666;
    }
    
    /* Color selection styling */
    .color-selection {
        margin-bottom: 1.5rem;
    }
    
    .color-options {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
    }
    
    .color-radio {
        display: none;
    }
    
    .color-btn {
        width: 30px;
        height: 30px;
        border-radius: 50%;
        cursor: pointer;
        display: inline-block;
        border: 2px solid transparent;
        box-shadow: 0 0 3px rgba(0,0,0,0.1);
        transition: all 0.3s;
    }
    
    .color-radio:checked + .color-btn {
        border: 2px solid #333;
        transform: scale(1.1);
        box-shadow: 0 0 5px rgba(0,0,0,0.3);
    }
    
    /* Size selection styling */
    .option-title {
        font-weight: 500;
        color: #333;
        margin-bottom: 12px;
    }
    
    .size-radio {
        display: none;
    }
    
    .size-options {
        display: flex;
        gap: 10px;
    }
    
    .size-btn {
        display: flex;
        align-items: center;
        justify-content: center;
        width: 45px;
        height: 45px;
        border: 2px solid #ddd;
        border-radius: 8px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s ease;
    }
    
    .size-btn:hover, .size-btn.active-size {
        background-color: #333;
        color: white;
        border-color: #333;
    }
    
    /* Quantity selector styling */
    .quantity-selector {
        display: flex;
        align-items: center;
        height: 45px;
        border-radius: 8px;
        overflow: hidden;
        width: fit-content;
        border: 1px solid #ddd;
    }
    
    .qty-btn {
        display: flex;
        align-items: center;
        justify-content: center;
        width: 45px;
        height: 45px;
        background-color: #f5f5f5;
        cursor: pointer;
        transition: background-color 0.2s;
    }
    
    .qty-btn:hover {
        background-color: #eaeaea;
    }
    
    .qty-input {
        width: 60px;
        height: 45px;
        text-align: center;
        border: none;
        outline: none;
        font-size: 1rem;
    }
    
    /* Button styling */
    .add-to-cart-btn {
        padding: 12px 30px;
        background-color: #e63946;
        color: white;
        border: none;
        border-radius: 8px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.3s ease;
    }
    
    .add-to-cart-btn:hover {
        background-color: #c1121f;
        transform: translateY(-2px);
    }
    
    .wishlist-btn {
        display: flex;
        align-items: center;
        justify-content: center;
        width: 45px;
        height: 45px;
        background-color: transparent;
        border: 1px solid #ddd;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.3s ease;
    }
    
    .wishlist-btn:hover {
        background-color: #f8f8f8;
        color: #e63946;
    }
    
    /* Banner styling */
    .page-heading-banner {
        position: relative;
        padding: 100px 0;
        background-size: cover;
        background-position: center;
        text-align: center;
        margin-bottom: 30px;
        color: white;
        background-color: #333;
    }
    
    .page-heading-banner:before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
    }
    
    .page-heading-banner .container {
        position: relative;
        z-index: 2;
    }
    
    .page-heading-banner h2 {
        color: white;
        font-size: 2.5rem;
        font-weight: 700;
        text-transform: uppercase;
        margin: 0;
        letter-spacing: 1px;
    }
</style>
{% endblock %}

{% block javascripts %}
{{ parent() }}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Handle size selection
        const sizeInputs = document.querySelectorAll('input[name="size"]');
        const selectedSizeInput = document.getElementById('selected-size');
        
        sizeInputs.forEach(input => {
            input.addEventListener('change', function() {
                if(this.checked) {
                    selectedSizeInput.value = this.value;
                    
                    // Update visual styling for selected size
                    document.querySelectorAll('.size-btn').forEach(btn => {
                        btn.classList.remove('active-size');
                    });
                    
                    document.querySelector('label[for="' + this.id + '"]').classList.add('active-size');
                }
            });
        });
        
        // Initialize first size as selected
        document.querySelector('label[for="size-s"]').classList.add('active-size');
        
        // Handle color selection
        const colorInputs = document.querySelectorAll('input[name="color"]');
        const selectedColorInput = document.getElementById('selected-color');
        
        if (colorInputs.length > 0) {
            colorInputs.forEach(input => {
                input.addEventListener('change', function() {
                    if(this.checked) {
                        selectedColorInput.value = this.value;
                    }
                });
            });
        }
        
        // Handle quantity changes
        const quantityInput = document.querySelector('.qty-input');
        const selectedQuantityInput = document.getElementById('selected-quantity');
        const btnUp = document.querySelector('.btn-num-product-up');
        const btnDown = document.querySelector('.btn-num-product-down');
        
        // Update hidden field when quantity changes
        quantityInput.addEventListener('change', function() {
            if(this.value < 1) this.value = 1;
            selectedQuantityInput.value = this.value;
        });
        
        // Plus button
        btnUp.addEventListener('click', function() {
            let currentValue = parseInt(quantityInput.value);
            quantityInput.value = currentValue + 1;
            selectedQuantityInput.value = quantityInput.value;
        });
        
        // Minus button
        btnDown.addEventListener('click', function() {
            let currentValue = parseInt(quantityInput.value);
            if(currentValue > 1) {
                quantityInput.value = currentValue - 1;
                selectedQuantityInput.value = quantityInput.value;
            }
        });
        
        // Wishlist button toggle effect
        const wishlistBtn = document.querySelector('.wishlist-btn');
        if(wishlistBtn) {
            wishlistBtn.addEventListener('click', function() {
                this.classList.toggle('text-danger');
            });
        }
    });
</script>
{% endblock %}
